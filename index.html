<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3M-THS Mobile</title>
    <style>
        /* Add your CSS styles here */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        header {
            background-color: #333;
            color: #fff;
            padding: 10px;
            text-align: center;
        }
        .container {
            max-width: 90%; /* Adjusted for better mobile responsiveness */
            margin: 20px auto;
            padding: 0 10px;
        }
        /* Add more styles as needed for responsiveness */
        .logo-container {
            text-align: center;
            margin-bottom: 20px; /* Add some space below the logo */
        }
        .logo-container img {
            max-width: 100%;
            height: auto;
        }
        form {
            margin-bottom: 20px; /* Add space below the form */
        }
        label {
            display: block; /* Display label on a new line */
            margin-bottom: 5px; /* Added margin for spacing */
        }
        input[type="text"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            box-sizing: border-box; /* Ensure input width includes padding */
        }
        button[type="submit"] {
            width: 100%;
            padding: 10px;
            background-color: #333;
            color: #fff;
            border: none;
            cursor: pointer;
        }
        #suggestionsDropdown {
            width: calc(100% - 22px); /* Adjusted for input padding and border */
            position: relative;
            z-index: 1;
            display: none; /* Hide the dropdown initially */
        }
        
        
        #suggestionsDropdown option {
            background-color: #f9f9f9;
            padding: 10px;
        }

            /* CSS for plus symbol */
        .plus-symbol {
            display: inline-block;
            width: 30px;
            height: 30px;
            line-height: 30px;
            text-align: center;
            border-radius: 50%;
            background-color: #333;
            color: #fff;
            font-size: 20px;
            cursor: pointer;
            position: absolute;
            top: 50%;
            transform: translateY(-50%); /* Vertically center the button */
            right: 10px; /* Adjusted to place it on the right */
        }


                /* CSS for stock info container */
        .stock-info {
            position: relative;
            padding: 20px;
            margin-bottom: 20px;
            background-color: #f9f9f9;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* CSS for individual paragraphs */
        .stock-info p {
            margin: 10px 0;
            font-size: 16px;
        }

        /* CSS for smaller text */
        .small-text {
            font-size: 14px;
        }

        /* CSS for bold text */
        .stock-info strong {
            font-weight: bold;
        }

        /* CSS for red text */
        .red-text {
            color: red;
        }

        /* CSS for blue text */
        .blue-text {
            color: blue;
        }

    </style>
</head>
<body>
    <header>
        <div class="logo-container">
            <img src="logo_remove.png" alt="THS Logo">
        </div>
    </header>
    <div class="container">
        <h2>Kiểm tra tồn kho 3M</h2>
        <form id="searchForm">
            <label for="item">Nhập mã hoặc tên hàng:</label>
            <input type="text" id="searchInput" name="item" placeholder="Nhập mã hoặc tên hàng...">
            <select id="suggestionsDropdown" size="5"></select> <!-- Select element for suggestions -->
            <button type="submit">Tìm kiếm</button>
        </form>
        <!-- Display stock information here -->
        <div id="stock-info">
            <!-- Stock information will be displayed here -->
        </div>
    </div>
    <!-- Add your scripts here -->
    <script>
        let searchResults = []; // Array to store search results
        let currentSuggestions = []; // Array to store current suggestions
        let allData = []; // Variable to store all data

        const sheetId = '1z78L-ekU5Lk-F3b4VHhKS3b1lEYmbbG9bUjmG4ss6Zc'; // Replace 'YOUR_SHEET_ID' with your actual sheet ID
        const apiKey = 'AIzaSyCC44a5q3PVMDLMNHKkeNU6LmLDM9vxdL8'; // Replace 'YOUR_API_KEY' with your actual API key

        const maxSuggestions = 10; // Maximum number of suggestions to display

        function fetchData() {
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/Trang tính1?key=${apiKey}`;
            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to fetch data');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Data from Google Sheets:', data);
                    // Store all data except header row
                    allData = data.values.slice(1);
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                });
        }

        // Call fetchData function when the page loads
        window.onload = function() {
            fetchData();
            // Refresh data periodically (every 5 minutes)
            setInterval(fetchData, 5 * 60 * 1000);
        };

        // Function to suggest goods based on user input
        function suggestGoods() {
            const input = document.getElementById('searchInput').value.trim().toLowerCase(); // Trim whitespace from input and convert to lowercase

            // Show the dropdown only if there are suggestions and input is not empty
            const dropdown = document.getElementById('suggestionsDropdown');
            dropdown.style.display = currentSuggestions.length === 0 || input === '' ? 'none' : 'block';

            if (input === '') {
                dropdown.innerHTML = ''; // Clear dropdown if input is empty
                return;
            }

            // Search for suggestions based on index [1]
            const suggestions = allData.filter(row => row[1].toLowerCase().includes(input)).map(row => row[1]);
            currentSuggestions = suggestions.slice(0, maxSuggestions);
            displaySuggestions(currentSuggestions); // Display the suggestions in dropdown
        }

        // Function to display suggestions in dropdown
        function displaySuggestions(suggestions) {
            const dropdown = document.getElementById('suggestionsDropdown');
            dropdown.innerHTML = ''; // Clear previous suggestions
            if (suggestions.length > 0) {
                dropdown.style.display = 'block';
                suggestions.forEach(suggestion => {
                    const option = document.createElement('option');
                    option.value = suggestion;
                    option.textContent = suggestion; // Set the content of the option
                    dropdown.appendChild(option);

                    // Add click event listener to each suggestion
                    option.addEventListener('click', function() {
                        // Set the value of the search input to the selected suggestion
                        document.getElementById('searchInput').value = suggestion;
                        // Hide the suggestions dropdown
                        dropdown.style.display = 'none';
                    });
                });

                // Adjust the height of the dropdown to fit all suggestions
                dropdown.size = suggestions.length;
            } else {
                dropdown.style.display = 'none';
            }
        }

        // Add event listener to input field to suggest goods when typing
        document.getElementById('searchInput').addEventListener('input', suggestGoods);

        // Add event listener to form submission to handle search
        document.getElementById('searchForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent form submission
            search(); // Call the search function
        });

            // Function to perform search based on user input
        function search() {
            const inputElement = document.getElementById('searchInput');
            const input = inputElement.value.trim().toLowerCase(); // Trim whitespace from input and convert to lowercase

            console.log('Searching for:', input);

            // Search for the input in index [1] (name column)
            const result = allData.find(row => row[1].toLowerCase().includes(input));

            if (result) {
                // If result found, display stock information
                displayStockInfo(result);
            } else {
                // If result not found, display message
                document.getElementById('stock-info').textContent = 'Không tìm thấy hàng.';
            }

            // Hide the dropdown after search
            document.getElementById('suggestionsDropdown').style.display = 'none';

            // Clear the search box
            inputElement.value = '';
        }


        // Function to display stock information
        function displayStockInfo(result) {
            const [code, name, quantity, price, unit, expireDate] = result;
            const stockInfoContainer = document.getElementById('stock-info');
            stockInfoContainer.innerHTML = ''; // Clear previous content

            // Create a div element to contain the stock information
            const stockInfoDiv = document.createElement('div');
            stockInfoDiv.classList.add('stock-info');

            // Create paragraph elements for each piece of information
            const namePara = document.createElement('p');
            namePara.innerHTML = `<strong class="name">${name}</strong>`; // Bold name
            stockInfoDiv.appendChild(namePara);

            const pricePara = document.createElement('p');
            pricePara.innerHTML = ` <span class="price ${quantity > 0 ? 'small-text' : 'small-text red-text'}">${price}</span>`; // Downsize price and color based on stock
            stockInfoDiv.appendChild(pricePara);

            const quantityPara = document.createElement('p');
            quantityPara.innerHTML = `<strong class="${quantity > 0 ? 'small-text blue-text' : 'small-text red-text'}">Tồn:</strong> <span class="quantity small-text">${quantity}</span>`; // Downsize quantity and color based on stock
            stockInfoDiv.appendChild(quantityPara);

            const expireDatePara = document.createElement('p');
            expireDatePara.innerHTML = `<strong class="small-text">Date:</strong> <span class="expire-date small-text">${expireDate}</span>`; // Downsize expiration date
            stockInfoDiv.appendChild(expireDatePara);

            // Create a span element for the plus symbol
            const plusSymbol = document.createElement('span');
            plusSymbol.textContent = '+';
            plusSymbol.classList.add('plus-symbol');
            plusSymbol.addEventListener('click', function() {
                // Here you can implement the logic to add the item to the cart
                addToCart(result);
            });
            stockInfoDiv.appendChild(plusSymbol);

            // Append the stockInfoDiv to the stockInfoContainer
            stockInfoContainer.appendChild(stockInfoDiv);

            stockInfoContainer.style.display = 'block'; // Show the stock info container
        }
    </script>
</body>
</html>
